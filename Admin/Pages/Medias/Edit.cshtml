@page "{mediaid}"
@model Admin.Pages.Medias.EditModel

@{
    ViewData["Title"] = "Edit";
}

<h1>Edit</h1>

<div class="text-danger text-opacity-75" asp-validation-summary="All">

</div>

<div class="row">
    <div class="col">
        <div class="card">
            <div class="card-header">
                <ul class="nav nav-pills card-header-pills">
                    @foreach (var item in Enum.GetNames<LanguageEnum>())
                    {
                        <li class="nav-item">
                            <a id='@($"lang_nav_{item}")' class="nav-link" aria-current="true" href="#">@item</a>
                        </li>
                    }
                </ul>
            </div>
            <form method="post" class="text-center" enctype="multipart/form-data">
                <input hidden asp-for="@Model.Media.MediaTypeId" />
                <input hidden asp-for="@Model.Media.AuthorId" />
                <input hidden asp-for="@Model.Media.CreatedAt" />
                <input hidden asp-for="@Model.Media.Id" />
                @for (var i = 0; i < Model.Media.MediaTranslations.Count; i++)
                {
                    <div id='@($"lang_body_{ Enum.GetName<LanguageEnum>(Model.Media.MediaTranslations[i].LanguageId)}")' class="card-body">
                        <input hidden asp-for="@Model.Media.MediaTranslations[i].Id" />
                        <input hidden asp-for="@Model.Media.MediaTranslations[i].LanguageId" />
                        <input hidden asp-for="@Model.Media.MediaTranslations[i].MediaId" />
                        <input hidden asp-for="@Model.Media.MediaTranslations[i].Url" />

                        <label asp-for="@Model.Media.MediaTranslations[i].Title" class="control-label"></label>
                        <input asp-for="@Model.Media.MediaTranslations[i].Title" class="form-control" />
                        <span asp-validation-for="@Model.Media.MediaTranslations[i].Title" class="text-danger"></span>

                        <label asp-for="@Model.Media.MediaTranslations[i].Description" class="control-label"></label>
                        <input asp-for="@Model.Media.MediaTranslations[i].Description" class="form-control" />
                        <span asp-validation-for="@Model.Media.MediaTranslations[i].Description" class="text-danger"></span>

                        <input hidden id='@($"url_file_{ Enum.GetName<LanguageEnum>(Model.Media.MediaTranslations[i].LanguageId)}")' value="@Model.Media.MediaTranslations[i].Url" />
                        <label asp-for="@Model.Media.MediaTranslations[i].Url" class="control-label"></label>
                        <input asp-for="@Model.Files[Model.Media.MediaTranslations[i].LanguageId]" type="file" class="form-control" accept="audio/*,video/*,image/*,MIME_type" id='@($"select_file_{ Enum.GetName<LanguageEnum>(Model.Media.MediaTranslations[i].LanguageId)}")' />
                        <input hidden name="Files[@Model.Media.MediaTranslations[i].LanguageId].Key" value="@Model.Media.MediaTranslations[i].LanguageId" />
                        <span asp-validation-for="@Model.Media.MediaTranslations[i].Url" class="text-danger"></span>
                        <div id='@($"preview_file_{ Enum.GetName<LanguageEnum>(Model.Media.MediaTranslations[i].LanguageId)}")' class="preview">
                            <p>No files currently selected for upload</p>
                        </div>
                    </div>
                }
                <input type="submit" class="btn btn-primary m-3" value="Update" />
            </form>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        let langs = @(Json.Serialize(Enum.GetNames<LanguageEnum>()));

        function clearall()
        {
            for (var item of langs)
            {
                $(`#lang_nav_${item}`).removeClass("active");
                $(`#lang_body_${item}`).attr("hidden", "");
            }
        };

        function getactivetab() {
            for (var item of langs)
            {
                if($(`#lang_nav_${item}`).hasClass("active"))
                    return item;
            }
        };

        function initimage(lang) {
            var hidenurl = $(`#url_file_${lang}`).get();
            var url = hidenurl[0].value;
                if (url != "") {
                    updateimage(`/images/${url}`);
                }
        };

        function updateimage(url)
        {
            var preview = $(`#preview_file_${getactivetab()}`);
            preview.children().remove();
            var img = $("<img>");
            img.attr("src", url);
            img.addClass("img-thumbnail img-fluid m-3");
            preview.prepend(img);
        }

        $(document).ready(function () {
            clearall();
            $('@($"#lang_nav_{Enum.GetNames<LanguageEnum>().First()}")').addClass("active");
            $('@($"#lang_body_{Enum.GetNames<LanguageEnum>().First()}")').removeAttr("hidden");
            @foreach (var item in Enum.GetNames<LanguageEnum>())
            {
                @:initimage('@item');
                @:$('@($"#lang_nav_{item}")').on("click", function()
                @:{
                    @:clearall();
                    @:$('@($"#lang_nav_{item}")').addClass("active");
                    @:$('@($"#lang_body_{item}")').removeAttr("hidden");
                    @:initimage('@item');
                @:});
                @:$('@($"#select_file_{item}")').on('change', function () {
                    @:updateimage(window.URL.createObjectURL(this.files[0]));
                @:});
            }
        });
    </script>
    <partial name="_ValidationScriptsPartial" />
}
